<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>Sora 资讯看板</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 p-6">
    <div class="max-w-2xl mx-auto bg-white p-8 rounded-3xl shadow-xl">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold text-indigo-600">Sora Hub</h1>
            <button onclick="start()" id="btn" class="bg-indigo-600 text-white px-6 py-2 rounded-full">刷新资讯</button>
        </div>
        <div id="box" class="space-y-4 text-sm text-slate-500">
            等待指令...
        </div>
    </div>

    <script>
        // 你的核心配置
        const TOKEN = 'pat_s1Ogj5Ooe6vuIEaqoLrLgvgCdkAlf4t2nawIUrvbk7ffgedSfgDU7FnwG5MHhaP9';
        const BOT_ID = '7603364148260487221';

        async function start() {
            const btn = document.getElementById('btn');
            const box = document.getElementById('box');
            btn.disabled = true;
            box.innerHTML = "正在发起连接...";

            try {
                // 1. 发起对话 (V3 接口最精简写法)
                const res = await fetch('https://api.coze.com/v3/chat', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + TOKEN,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        bot_id: BOT_ID,
                        user_id: "user_" + Math.floor(Math.random() * 1000),
                        stream: false,
                        additional_messages: [{
                            role: "user",
                            content: "搜索今日 Sora 资讯，返回 JSON 数组 [{\"title\":\"\", \"url\":\"\"}]",
                            content_type: "text"
                        }]
                    })
                });

                const data = await res.json();
                console.log("完整原始返回:", data);

                if (data.code === 0) {
                    box.innerHTML = `<div class="p-4 bg-green-50 text-green-700 rounded-xl">
                        <b>连接成功！</b><br>
                        对话 ID: ${data.data.id}<br>
                        状态: ${data.data.status}<br><br>
                        请注意：由于 API 是异步的，数据正在后台生成。只要看到这个消息，说明你的配置已经彻底通了！
                    </div>`;
                } else {
                    box.innerHTML = `<div class="p-4 bg-red-50 text-red-600 rounded-xl">服务器拒绝：${data.msg}</div>`;
                }
            } catch (err) {
                box.innerHTML = `<div class="p-4 bg-orange-50 text-orange-600 rounded-xl">
                    <b>连接被拦截 (Failed to fetch)</b><br>
                    建议操作：<br>
                    1. 检查是否开启了网络代理，尝试关闭它。<br>
                    2. 尝试换一个浏览器（推荐 Chrome）。<br>
                    3. 确定你是在 https://xyczy07-ai.github.io 下运行。
                </div>`;
            } finally {
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
