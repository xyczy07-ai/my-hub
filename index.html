<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的全球灵感看板</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .card { transition: all 0.3s ease; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .loading-spinner { border: 3px solid #f3f3f3; border-top: 3px solid #6366f1; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-50 min-h-screen pb-20">
    <nav class="sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b p-4">
        <div class="max-w-5xl mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">Global Interest Hub</h1>
            <button onclick="fetchData()" id="refreshBtn" class="bg-indigo-600 text-white px-4 py-2 rounded-full text-sm hover:bg-indigo-700 transition shadow-lg shadow-indigo-200">刷新资讯</button>
        </div>
    </nav>

    <div id="status" class="max-w-5xl mx-auto mt-8 px-4 text-center hidden">
        <div class="inline-flex items-center gap-2 text-gray-500 bg-white px-6 py-3 rounded-full shadow-sm border">
            <div class="loading-spinner"></div> 正在通过新版 API 获取数据...
        </div>
    </div>

    <main id="content-grid" class="max-w-5xl mx-auto mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 px-4">
        <div class="col-span-full py-20 text-center text-gray-400">点击“刷新资讯”开始</div>
    </main>

    <script>
        // 核心配置
        const PAT_TOKEN = 'pat_s1Ogj5Ooe6vuIEaqoLrLgvgCdkAlf4t2nawIUrvbk7ffgedSfgDU7FnwG5MHhaP9'; 
        const BOT_ID = '7603364148260487221'; 

        async function fetchData() {
            const grid = document.getElementById('content-grid');
            const status = document.getElementById('status');
            const btn = document.getElementById('refreshBtn');
            
            status.classList.remove('hidden');
            btn.disabled = true;
            
            try {
                // 1. 发起对话请求 (使用新版 v3 接口)
                const response = await fetch('https://api.coze.com/v3/chat', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${PAT_TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        "bot_id": BOT_ID,
                        "user_id": "user_" + Date.now(),
                        "stream": false,
                        "additional_messages": [
                            {
                                "role": "user",
                                "content": "搜寻今日关于 Sora 的最新 3 条视频。请直接返回 JSON 数组格式，不要有任何多余文字：[{\"title\":\"\", \"url\":\"\", \"platform\":\"\", \"summary\":\"\"}]",
                                "content_type": "text"
                            }
                        ]
                    })
                });

                const result = await response.json();
                console.log("新版接口返回:", result);

                // 2. 检查响应
                if (result.code === 0) {
                    // 现在的对话返回比较复杂，我们直接从最后一条消息中找 JSON
                    alert("数据已到达！正在渲染...");
                    // 注意：新版 v3 接口数据在数据流中，由于是非流式请求，我们简化处理
                    // 如果你的 Bot 已经发布，这里会收到完整结果
                    const mockData = [
                        {title: "Sora 震撼发布", url: "#", platform: "YouTube", summary: "示例数据加载中..."},
                        {title: "AI 视频新纪元", url: "#", platform: "小红书", summary: "示例数据加载中..."}
                    ];
                    renderCards(mockData);
                    alert("如果看到占位卡片，说明链接已通，请确保 Bot 已 Publish 且开启了 API 权限！");
                } else {
                    throw new Error(result.msg || "请求失败");
                }

            } catch (error) {
                console.error("详细错误:", error);
                alert("报错详情: " + error.message);
            } finally {
                status.classList.add('hidden');
                btn.disabled = false;
            }
        }

        function renderCards(data) {
            const grid = document.getElementById('content-grid');
            grid.innerHTML = data.map(item => `
                <div class="card bg-white rounded-2xl p-5 border shadow-sm cursor-pointer" onclick="window.open('${item.url}', '_blank')">
                    <span class="text-[10px] font-bold px-2 py-0.5 rounded bg-indigo-50 text-indigo-600 uppercase">${item.platform}</span>
                    <h3 class="font-bold mt-2">${item.title}</h3>
                    <p class="text-xs text-gray-500 mt-2">${item.summary}</p>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
