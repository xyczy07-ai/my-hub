<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的全球灵感看板</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .card { transition: all 0.3s ease; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .loading-spinner { border: 3px solid #f3f3f3; border-top: 3px solid #6366f1; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-50 min-h-screen pb-20">
    <nav class="sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b p-4">
        <div class="max-w-5xl mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">Global Interest Hub</h1>
            <button onclick="fetchData()" id="refreshBtn" class="bg-indigo-600 text-white px-4 py-2 rounded-full text-sm hover:bg-indigo-700 transition shadow-lg shadow-indigo-200">刷新资讯</button>
        </div>
    </nav>

    <div id="status" class="max-w-5xl mx-auto mt-8 px-4 text-center hidden">
        <div class="inline-flex items-center gap-2 text-gray-500 bg-white px-6 py-3 rounded-full shadow-sm border">
            <div class="loading-spinner"></div> 正在调取 AI 大脑数据...
        </div>
    </div>

    <main id="content-grid" class="max-w-5xl mx-auto mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 px-4">
        <div class="col-span-full py-20 text-center text-gray-400">
            点击上方“刷新资讯”开始抓取最新内容
        </div>
    </main>

    <script>
        // ======= 核心配置 =======
        const PAT_TOKEN = 'pat_s1Ogj5Ooe6vuIEaqoLrLgvgCdkAlf4t2nawIUrvbk7ffgedSfgDU7FnwG5MHhaP9'; 
        const BOT_ID = '7603364148260487221'; 

        async function fetchData() {
            const grid = document.getElementById('content-grid');
            const status = document.getElementById('status');
            const btn = document.getElementById('refreshBtn');
            
            status.classList.remove('hidden');
            btn.disabled = true;
            btn.innerText = "抓取中...";
            
            try {
                const response = await fetch('https://api.coze.com/v1/chat', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${PAT_TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        "bot_id": BOT_ID,
                        "user_id": "web_user_" + Date.now(),
                        "query": "请帮我搜寻今日关于 Sora 的最新 3-5 条视频资讯。请务必以标准的 JSON 数组格式返回，格式如下：[{\"title\":\"标题\", \"url\":\"链接\", \"platform\":\"平台\", \"summary\":\"简介\"}]。不要包含任何解释性文字。",
                        "stream": false
                    })
                });

                const result = await response.json();
                console.log("Coze 返回原始数据:", result);

                if (result.code !== 0) {
                    throw new Error(`Coze API 错误: ${result.msg}`);
                }

                // 提取 AI 的回答内容
                const answerObj = result.messages.find(m => m.type === 'answer');
                if (!answerObj) throw new Error("AI 没有给出有效回答");
                
                let content = answerObj.content;
                
                // 关键点：从 AI 的回答中通过正则表达式提取出 JSON 部分
                const jsonMatch = content.match(/\[[\s\S]*\]/);
                if (!jsonMatch) throw new Error("AI 返回的格式不是标准 JSON 列表");
                
                const data = JSON.parse(jsonMatch[0]);
                renderCards(data);
            } catch (error) {
                console.error("详细错误:", error);
                grid.innerHTML = `<div class="col-span-full p-10 bg-red-50 text-red-500 rounded-xl text-center border border-red-100">
                    <p class="font-bold">获取失败</p>
                    <p class="text-sm mt-2">${error.message}</p>
                    <p class="text-xs mt-4 opacity-50">请检查：1. Bot 是否已 Publish 到 API？ 2. Token 权限是否包含 chat/createConversation？</p>
                </div>`;
            } finally {
                status.classList.add('hidden');
                btn.disabled = false;
                btn.innerText = "刷新资讯";
            }
        }

        function renderCards(data) {
            const grid = document.getElementById('content-grid');
            if (!data || data.length === 0) {
                grid.innerHTML = `<div class="col-span-full text-center text-gray-400 py-20">未找到相关数据</div>`;
                return;
            }
            grid.innerHTML = data.map(item => `
                <div class="card bg-white rounded-2xl overflow-hidden border border-gray-100 cursor-pointer flex flex-col h-full shadow-sm" onclick="window.open('${item.url}', '_blank')">
                    <div class="p-5 flex-1">
                        <div class="flex items-center gap-2 mb-3">
                            <span class="text-[10px] font-bold px-2 py-0.5 rounded bg-indigo-50 text-indigo-600 uppercase border border-indigo-100">${item.platform || 'NEWS'}</span>
                        </div>
                        <h3 class="font-bold text-gray-900 mb-2 line-clamp-2 text-base">${item.title}</h3>
                        <p class="text-xs text-gray-500 leading-relaxed line-clamp-4">${item.summary || '暂无简介'}</p>
                    </div>
                    <div class="px-5 py-4 bg-gray-50 border-t border-gray-100 text-indigo-600 text-xs font-semibold flex justify-between items-center">
                        <span>查看原文</span>
                        <span>→</span>
                    </div>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
